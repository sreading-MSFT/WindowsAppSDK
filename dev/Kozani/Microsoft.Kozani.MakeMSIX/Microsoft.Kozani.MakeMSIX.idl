// Copyright (c) Microsoft Corporation and Contributors.
// Licensed under the MIT License.

namespace Microsoft.Kozani.MakeMSIX
{
    [contractversion(1)]
    apicontract MakeMSIXContract{};

    /// Options for creating a package
    [contract(MakeMSIXContract, 1)]
    runtimeclass PackOptions
    {
        /// <summary>
        /// Created by callers to pass options into CreatePackage
        /// </summary>
        PackOptions();

        /// <summary>
        /// Output path for the full packaged file.
        /// </summary>
        String PackageFilePath{ get; set; };

        /// <summary>
        /// Overwrite PackageFilePath if it already exists.
        /// Defaults to true.
        /// </summary>
        Boolean OverwriteFiles{ get; set; };
        /// <summary>
        /// Validates elements of the package during creation.
        /// Defaults to false.
        /// </summary>
        Boolean ValidateFiles{ get; set; };
    };

    /// Options for creating a Kozani package
    [contract(MakeMSIXContract, 1)]
    runtimeclass CreateKozaniPackageOptions
    {
        /// <summary>
        /// Created by callers to pass options into CreateKozaniPackage
        /// </summary>
        CreateKozaniPackageOptions();

        /// <summary>
        /// Output path for the kozani packaged file.
        /// Format must match input file. If packageFilePathToConvert is an appx or msix, then PackageFilePath must be an appx or msix.
        /// If packageFilePathToConvert is an appxbundle or msixbundle, then PackageFilePath must be an appxbundle or msixbundle.
        /// </summary>
        String PackageFilePath{ get; set; };

        /// <summary>
        /// Optional replacement package publisher.
        /// If not set, publisher from appxmanifest.xml is unchaged.
        /// </summary>
        String PackagePublisher{ get; set; };

        /// <summary>
        /// Optional replacement package name.
        /// If not set, name from appxmanifest.xml is unchaged.
        /// </summary>
        String PackageName{ get; set; };

        /// <summary>
        /// Overwrite PackageFilePath if it already exists.
        /// Defaults to true.
        /// </summary>
        Boolean OverwriteFiles{ get; set; };
        /// <summary>
        /// Validates elements of the package during creation.
        /// Defaults to false.
        /// </summary>
        Boolean ValidateFiles{ get; set; };
    };

    /// Options for creating a bundle
    [contract(MakeMSIXContract, 1)]
    runtimeclass BundleOptions
    {
        /// <summary>
        /// Created by callers to pass options into Bundle
        /// </summary>
        BundleOptions();

        /// <summary>
        /// Output path for the full bundled file.
        /// </summary>
        String BundleFilePath{ get; set; };

        /// <summary>
        /// Overwrite BundleFilePath if they already exist.
        /// Defaults to true.
        /// </summary>
        Boolean OverwriteFiles{ get; set; };

        /// <summary>
        /// Create as a flat bundle. Package locations will be stored as external path references
        /// rather than being stored inside the msixbundle file itself. 
        /// Defaults to false.
        /// </summary>
        Boolean FlatBundle{ get; set; };

        /// <summary>
        /// Optional. Sets the version in the AppxBundleManifest.xml
        /// If not set the version is created based on the current time.
        /// </summary>
        Windows.ApplicationModel.PackageVersion BundleVersion{ get; set; };
    };

    /// <summary>
    /// Options for unpacking a package
    /// </summary>
    [contract(MakeMSIXContract, 1)]
    runtimeclass UnpackOptions
    {
        /// <summary>
        /// Created by callers to pass options into Unpack
        /// </summary>
        UnpackOptions();

        /// <summary>
        /// The output folder to unpack the package into.
        /// </summary>
        String UnpackedPackageRootDirectory{ get; set; };
        /// <summary>
        /// If true, the operation will overwrite existing files in the UnpackedPackageRootDirectory
        /// when unpacking.
        /// If false, the operation will fail if a file already exists.
        /// </summary>
        Boolean OverwriteFiles{ get; set; };
    };

    /// <summary>
    /// Options for unpacking a package
    /// </summary>
    [contract(MakeMSIXContract, 1)]
    runtimeclass UnbundleOptions
    {
        /// <summary>
        /// Created by callers to pass options into UnpackPackage
        /// </summary>
        UnbundleOptions();

        /// <summary>
        /// The output folder to unpack the bundle package into.
        /// </summary>
        String UnbundledPackageRootDirectory{ get; set; };
        /// <summary>
        /// If true, the operation will overwrite existing files in the UnbundledPackageRootDirectory
        /// when unpacking.
        /// If false, the operation will fail if a file already exists.
        /// </summary>
        Boolean OverwriteFiles{ get; set; };
    };

    /// <summary>
    /// 
    /// </summary>
    [contract(MakeMSIXContract, 1)]
    runtimeclass CreateMountableImageOptions
    {
        /// <summary>
        /// Created by callers to pass options into CreateMountableImage
        /// </summary>
        CreateMountableImageOptions();

        /// <summary>
        /// Output path for the image file.
        /// Valid file extensions are vhd, vhdx, and CIM.
        /// </summary>
        String ImageFilePath{ get; set; };

        /// <summary>
        /// Root directory path for packages inside the image.
        /// Defaults to "WindowsApps"
        /// </summary>
        String PackageRootDirectoryInImage{ get; set; };

        /// <summary>
        /// If true, the operation will overwrite an existing file in the ImageFilePath
        /// when unpacking.
        /// If false, the operation will fail if the file already exists.
        /// </summary>
        Boolean OverwriteFiles{ get; set; };
    };

    runtimeclass PackageId
    {
        String Name { get; set; };
        Windows.ApplicationModel.PackageVersion Version { get; set; };
        Windows.System.ProcessorArchitecture Architecture{ get; set; };
        String ResourceId{ get; set; };
        String Publisher{ get; set; };
        String PublisherId{ get; set; };
        String FullName{ get; set; };
        String FamilyName{ get; set; };
    }

    /// <summary>
    /// Static methods for creating and unpacking packages.
    /// </summary>
    [contract(MakeMSIXContract, 1)]
    runtimeclass MakeMSIXManager
    {
        /// <summary>
        /// Creates packages from the directoryPathToPack as specified by the packOptions.
        /// </summary>
        static Windows.Foundation.IAsyncAction Pack(String directoryPathToPack, PackOptions packOptions);
        /// <summary>
        /// Creates bundles from the directoryPathToBundle as specified by the bundleOptions.
        /// </summary>
        static Windows.Foundation.IAsyncAction Bundle(String directoryPathToBundle, BundleOptions bundleOptions);
        /// <summary>
        /// Unpacks a package at packageFilePathToUnpack as specified by the unpackOptions.
        /// </summary>
        static Windows.Foundation.IAsyncAction Unpack(String packageFilePathToUnpack, UnpackOptions unpackOptions);
        /// <summary>
        /// Unbundles a package at bundleFilePathToUnbundle as specified by the unbundleOptions.
        /// </summary>
        static Windows.Foundation.IAsyncAction Unbundle(
            String bundleFilePathToUnbundle,
            UnbundleOptions unbundleOptions);

        /// <summary>
        /// Creates a Kozani package from an existing package.
        /// packageFilePathToConvert can be an appx, appxbundle, msix, or msixbundle
        /// </summary>
        static Windows.Foundation.IAsyncAction CreateKozaniPackage(
            String packageFilePathToConvert,
            CreateKozaniPackageOptions createKozaniPackageOptions);

        /// <summary>
        /// Creates a mountable image that contains the packages at packageFilePathsToAdd.
        /// Can be used for Azure App Attach.
        /// </summary>
        static Windows.Foundation.IAsyncAction CreateMountableImage(
            Windows.Foundation.Collections.IVector<String> packageFilePathsToAdd,
            CreateMountableImageOptions createMountableImageOptions);

        /// <summary>
        /// Gets the identity information about a package 
        /// </summary>
        static Windows.Foundation.IAsyncOperation<PackageId> GetPackageIdentity(String packagePath);
    };
}
